#!/bin/bash

# This script compiles GSettings schemas for GNOME extensions located in /usr/share/gnome-shell/extensions
# It will skip extensions that do not contain a 'schemas' directory.

# Directory for GNOME extensions
EXTENSIONS_DIR="/usr/share/gnome-shell/extensions"

# Check if the directory exists
if [ ! -d "$EXTENSIONS_DIR" ]; then
  echo "Error: $EXTENSIONS_DIR does not exist."
  exit 1
fi

# Find all the extensions in the directory
for EXTENSION in "$EXTENSIONS_DIR"/*; do
  # Check if it's a directory (to handle only extension directories)
  if [ -d "$EXTENSION" ]; then
    # Look for the schemas directory in each extension
    SCHEMAS_DIR="$EXTENSION/schemas"
    
    # If the schemas directory exists, compile the schemas
    if [ -d "$SCHEMAS_DIR" ]; then
      echo "Compiling schemas for extension: $EXTENSION"

      # Compile the schemas for this extension
      glib-compile-schemas "$SCHEMAS_DIR"

      if [ $? -eq 0 ]; then
        echo "Schemas for extension '$EXTENSION' compiled successfully."
      else
        echo "Error compiling schemas for extension '$EXTENSION'."
      fi
    else
      # Skip this extension if there's no schemas directory
      echo "No 'schemas' directory found for extension: $EXTENSION. Skipping."
    fi
  fi
done

# Update the GSettings schema cache
echo "Updating GSettings schema cache..."
glib-compile-schemas /usr/share/glib-2.0/schemas

echo "Script completed."
